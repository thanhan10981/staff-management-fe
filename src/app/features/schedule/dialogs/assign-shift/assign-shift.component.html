<h2 class="title">Phân công ca làm việc</h2>

<form [formGroup]="form">
  <div class="form-error" *ngIf="errorMessage">
    {{ errorMessage }}
  </div>


  <!-- ===== BỐ CỤC 2 CỘT ===== -->
  <div class="top-grid">

    <!-- ==== LOẠI CA ==== -->
    <div>
      <label class="section-label">Loại ca làm việc</label>
      <mat-radio-group formControlName="maCa" class="radio-group">
        <mat-radio-button [value]="1">Ca sáng (06:30 - 14:30)</mat-radio-button>
        <mat-radio-button [value]="2">Ca chiều (14:30 - 22:00)</mat-radio-button>
        <mat-radio-button [value]="3">Ca tối (18:00 - 22:00)</mat-radio-button>
        <mat-radio-button [value]="4">Ca đêm (22:00 - 06:00)</mat-radio-button>
      </mat-radio-group>
    </div>

    <!-- ==== THỜI GIAN ==== -->
    <div class="time-column">
      <label class="section-label">Thời gian phân công</label>

      <div class="date-row">
        <mat-form-field appearance="outline">
          <mat-label>Từ ngày</mat-label>
          <input matInput [matDatepicker]="startPicker" formControlName="ngayBatDau">
          <mat-datepicker-toggle matSuffix [for]="startPicker"></mat-datepicker-toggle>
          <mat-datepicker #startPicker></mat-datepicker>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Đến ngày</mat-label>
          <input matInput [matDatepicker]="endPicker" formControlName="ngayKetThuc">
          <mat-datepicker-toggle matSuffix [for]="endPicker"></mat-datepicker-toggle>
          <mat-datepicker #endPicker></mat-datepicker>
        </mat-form-field>
      </div>

      <mat-checkbox formControlName="lapLaiHangTuan">
        Lặp lại hàng tuần
      </mat-checkbox>
    </div>

  </div>


  <!-- ===== PHÒNG BAN / ĐỊA ĐIỂM ===== -->
  <div class="row" style="margin-bottom: 24px;">
    <mat-form-field appearance="outline">
      <mat-label>Phòng ban</mat-label>
      <mat-select formControlName="maPhongBan">
        <mat-option [value]="null">Chọn phòng ban</mat-option>
        <mat-option *ngFor="let p of phongBans" [value]="p.id">
          {{ p.tenPhongBan }}
        </mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Địa điểm</mat-label>
      <mat-select formControlName="maPhongVL">
        <mat-option [value]="null">Chọn địa điểm</mat-option>
        <mat-option *ngFor="let p of phongVatLys" [value]="p.maPhong">
          {{ p.tenPhong }} ({{ p.soPhong }})
        </mat-option>
      </mat-select>
    </mat-form-field>
  </div>

  <!-- ===== DANH SÁCH NV ===== -->
  <label class="section-label">Danh sách nhân viên</label>

  <div class="employee-box">
    <div class="employee-header">Danh sách nhân viên</div>

    <div class="employee-list">
      <div class="employee-item" *ngFor="let nv of nhanViens">
        <mat-checkbox
          (change)="toggleNhanVien($event.checked, nv.maNhanVien)">
          {{ nv.tenNhanVien ?? nv.hoTen }}
        </mat-checkbox>
      </div>
    </div>
  </div>

  <!-- ===== GHI CHÚ ===== -->
  <mat-form-field appearance="outline" style="width: 100%; margin-top: 20px;">
    <mat-label>Ghi chú</mat-label>
    <textarea matInput rows="4" formControlName="ghiChu"></textarea>
  </mat-form-field>

</form>

<!-- FOOTER -->
<div class="footer">
  <button mat-stroked-button color="warn" (click)="cancel()">Hủy bỏ</button>
  <button mat-flat-button color="primary" (click)="assign()">Phân công</button>
</div>
