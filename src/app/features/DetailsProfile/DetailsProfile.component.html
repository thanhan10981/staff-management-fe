<div class="overlay" (click)="close()">
  <div class="popup" (click)="$event.stopPropagation()">

    <!-- Header -->
<!-- HEADER -->
  <div class="popup-header">
    <h3>Chỉnh sửa thông tin cá nhân</h3>
    <button class="close-btn" (click)="closeEditProfile()">✕</button>
  </div>

    <!-- Body -->
    <div class="popup-body">
      <app-head></app-head>

      <div class="info-grid">
        <app-profileinfo></app-profileinfo>
        <app-job-contact-info></app-job-contact-info>
      </div>

      <app-log-nearly></app-log-nearly>
      <app-setting
        [isOpen]="isChangePasswordOpen"
        (openPopup)="isChangePasswordOpen = true"
        (closePopup)="isChangePasswordOpen = false">
      </app-setting>

    </div>

    <!-- Footer -->
    <div class="popup-footer">
      <button class="btn btn-outline" (click)="close()">Đóng</button>
    <button
      class="btn btn-primary"
      (click)="openEditProfile()"
    >
      Chỉnh sửa thông tin
    </button>

    </div>

  </div>
</div>
<div
  class="overlay"
  *ngIf="isEditProfileOpen"
  (click)="closeEditProfile()"
>
  <div class="popup" (click)="$event.stopPropagation()">

    <!-- HEADER -->
    <div class="popup-header">
      <h3>Chỉnh sửa thông tin cá nhân</h3>
      <button class="close-btn" (click)="close()">✕</button>
    </div>

    <!-- BODY -->

    <div class="popup-body">
      <form #profileForm="ngForm" novalidate>
      <!-- Avatar -->
      <div class="avatar-section">
        <div class="avatar">
          <span>NA</span>
          <i class="camera ri-camera-fill"></i>
        </div>
        <p>Nhấp vào biểu tượng camera để thay đổi ảnh đại diện</p>
      </div>

      <!-- Form -->
      <div class="info-grid">

        <div class="form-group">
          <label>Họ và tên <span>*</span></label>
        <input
          type="text"
          name="hoTen"
          [(ngModel)]="formData.hoTen"
        />


        </div>

        <div class="form-group">
          <label>Email <span>*</span></label>

          <input
            type="email"
            name="email"
            required
            email
            [(ngModel)]="formData.email"
            #emailCtrl="ngModel"
          />

          <!-- lỗi -->
          <p class="error" *ngIf="emailCtrl.touched && emailCtrl.invalid">
            <span *ngIf="emailCtrl.errors?.['required']">
              Email không được để trống
            </span>
            <span *ngIf="emailCtrl.errors?.['email']">
              Email không đúng định dạng
            </span>
          </p>
        </div>


        <div class="form-group">
          <label>Ngày sinh</label>
          <input
            type="date"
            name="ngaySinh"
            [(ngModel)]="formData.ngaySinh"
          />

        </div>

        <div class="form-group">
          <label>Số điện thoại <span>*</span></label>
          <input
            type="text"
            name="sdt"
            [(ngModel)]="formData.sdt"
          />

        </div>

        <div class="form-group">
          <label>Giới tính</label>
          <select [(ngModel)]="formData.gioiTinh"   name="gioiTinh">
            <option [ngValue]="null">-- Chọn giới tính --</option>
            <option [ngValue]="true">Nam</option>
            <option [ngValue]="false">Nữ</option>
          </select>

        </div>

        <div class="form-group">
            <label>Mã nhân viên <span>*</span></label>
            <input
              type="text"
              [value]="maNhanVien"
              readonly
              class="readonly"
            />

        </div>

      <div class="form-group">
        <label>Khoa</label>
        <select [(ngModel)]="selectedMaKhoa"
          name="khoa"
          (ngModelChange)="onKhoaChange($event)">
          <option [ngValue]="null">-- Chọn khoa --</option>

          <option

          *ngFor="let khoa of khoaList"
          [ngValue]="khoa.id"


          >
            {{ khoa.tenKhoa }}
          </option>
        </select>
      </div>

      <div class="form-group">
        <label>Phòng ban <span>*</span></label>
        <select
            name="phongBan"
            [(ngModel)]="selectedPhongBanId"
            (ngModelChange)="onPhongBanChange($event)"
            
          >
            <option [ngValue]="null">-- Chọn phòng ban --</option>

            <option
              *ngFor="let pb of phongBanList"
              [ngValue]="pb.id"
            >
              {{ pb.tenPhongBan }}
            </option>
</select>

      </div>


        <div class="form-group full">
          <label>Vị trí công việc<span>*</span></label>
          <select
            name="viTri"
            [(ngModel)]="selectedViTriId"
            [disabled]="!viTriList.length"
          >

            <option [ngValue]="null">-- Chọn vị trí --</option>

          <option
            *ngFor="let vt of viTriList"
            [ngValue]="vt.id"
          >
            {{ vt.tenViTri }}
          </option>

          </select>


        </div>

      </div>
      </form>
    </div>

    <!-- FOOTER -->
    <div class="popup-footer">
      <button class="btn btn-outline" (click)="close()">Hủy</button>
      <button
        class="btn btn-primary"
        (click)="saveProfile()"
        [disabled]="profileForm.invalid"
      >
        Lưu thay đổi
      </button>

    </div>

  </div>
</div>
