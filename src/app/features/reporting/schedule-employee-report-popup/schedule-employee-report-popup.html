    <div class="popup-overlay" (click)="closePopup()"></div>

    <div class="popup-panel">
        <div class="popup-report">
            <!-- Header -->
            <div class="popup-title-row">
                <h2 class="popup-title">Báo cáo lịch trực</h2>
                <button class="popup-close" (click)="closePopup()">✕</button>
            </div>

            <div class="popup-scroll">
                <!-- Filter box -->
                <div class="filter-section">
                    <div class="filter-grid">
                        <div class="filter-item">
                            <label>Thời gian</label>
                            <select [(ngModel)]="filterTime">
                                <option value="THIS_WEEK">Tuần này</option>
                                <option value="LAST_WEEK">Tuần trước</option>
                                <option value="THIS_MONTH">Tháng này</option>
                            </select>
                        </div>

                        <div class="filter-item">
                            <label>Khoa</label>
                            <select [(ngModel)]="filterKhoa" (change)="onKhoaChange()">
                                <option value="">Tất cả khoa</option>
                                <option *ngFor="let k of listKhoa" [value]="k.maKhoa">
                                    {{ k.tenKhoa }}
                                </option>
                            </select>
                        </div>

                       <div class="filter-item">
                            <label>Phòng ban</label>
                            <select [(ngModel)]="filterPhongBan">
                                <option value="">Tất cả phòng ban</option>
                                <option *ngFor="let p of listPhongBan" [value]="p.maPhongBan">
                                    {{ p.tenPhongBan }}
                                </option>
                            </select>
                        </div>
                        <div class="filter-item">
                        <label>Chức vụ</label>
                            <select [(ngModel)]="filterViTri">
                                <option value="">Tất cả chức vụ</option>
                                <option *ngFor="let v of listViTri" [value]="v.maViTri">
                                {{ v.tenViTri }}
                                </option>
                            </select>
                        </div>
                        <div class="filter-item">
                        <label>Ca làm</label>
                            <select [(ngModel)]="filterCa">
                                <option value="">Tất cả ca</option>
                                <option value="Ca sáng">Ca sáng</option>
                                <option value="Ca chiều">Ca chiều</option>
                                <option value="Ca đêm">Ca đêm</option>
                            </select>
                        </div>

                        <button class="btn-search" (click)="applyFilters()">Lọc dữ liệu</button>

                    </div>
                </div>
                <p class="filter-range">
                        Tuần từ <b>22/01/2024</b> đến <b>28/01/2024</b>
                    </p>
                <div class="employee-table" [class.month-scroll]="isMonthView" id="pdf-report">
                    <table [style.minWidth.px]="isMonthView ? weekDates.length * 120 + 240 : null">
                        <thead>
                        <tr>
                            <th>Nhân viên</th>
                            <th *ngFor="let d of weekDates">
                            {{ d | date:'EEE dd/MM' }}
                            </th>
                        </tr>
                        </thead>
                        <tbody  class="table-body-scroll">
                            <tr *ngFor="let emp of data">

                                <!-- CỘT NHÂN VIÊN -->
                                <td class="emp-cell">
                                <img
                                    [src]="'https://i.pravatar.cc/40?u=' + emp.maNhanVien"
                                    class="avatar"
                                />
                                <div class="emp-info">
                                    <p class="emp-name">{{ emp.hoTen }}</p>
                                    <p class="emp-role">{{ emp.tenPhong }}</p>
                                </div>
                                </td>

                                <!-- CÁC NGÀY TRONG TUẦN -->
                                <td *ngFor="let d of weekDates">

                                <ng-container [ngSwitch]="getShift(emp, d)">

                                    <span
                                    *ngSwitchDefault
                                    class="badge"
                                    [ngClass]="{
                                        'badge-blue': getShift(emp, d) === 'Ca sáng',
                                        'badge-green': getShift(emp, d) === 'Ca chiều',
                                        'badge-purple': getShift(emp, d) === 'Ca đêm'
                                    }"
                                    >
                                    {{ getShift(emp, d) }}
                                    </span>
                                </ng-container>

                                </td>

                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Footer buttons -->
                <div class="popup-actions">
                    <button class="btn-download" (click)="exportExcel()">Xuất Excel</button>
                    <button class="btn-pdf"  (click)="printPDF()">Tải PDF</button>
                </div>
                <div class="statistic-grid">

                    <!-- Tổng ca trực -->
                    <div class="stat-box">
                        <div>
                            <p class="stat-label">Tổng ca trực</p>
                            <p class="stat-value">{{ totalShifts }}</p>
                        </div>
                        <div class="stat-icon icon-blue">
                            <svg viewBox="0 0 24 24" width="20" height="20">
                                <circle cx="12" cy="12" r="9" stroke-width="2"
                                    fill="none" />
                                <path d="M12 7v5l3 2" stroke-width="2"
                                    fill="none" />
                            </svg>
                        </div>
                    </div>

                    <!-- Ca nghỉ phép -->
                    <div class="stat-box">
                        <div>
                            <p class="stat-label">Ca nghỉ phép</p>
                            <p class="stat-value orange">{{ thieuNguoi }}</p>
                        </div>
                        <div class="stat-icon icon-orange">
                            <svg viewBox="0 0 24 24" width="20" height="20">
                                <rect x="3" y="5" width="18" height="16" rx="3"
                                    fill="none" />
                                <line x1="3" y1="10" x2="21" y2="10"
                                    stroke-width="2" />
                                <line x1="8" y1="3" x2="8" y2="7"
                                    stroke-width="2" />
                                <line x1="16" y1="3" x2="16" y2="7"
                                    stroke-width="2" />
                            </svg>
                        </div>
                    </div>

                    <!-- Tỷ lệ hoàn thành -->
                    <div class="stat-box">
                        <div>
                            <p class="stat-label">Tỷ lệ hoàn thành</p>
                           <p class="stat-value green">{{ completionRate }}%</p>
                        </div>
                        <div class="stat-icon icon-green">
                            <svg viewBox="0 0 24 24" width="20" height="20">
                                <polyline points="5 13 10 17 19 7" stroke-width="2"
                                    fill="none" />
                            </svg>
                        </div>
                    </div>

                </div>

            </div>
        </div>
    </div>